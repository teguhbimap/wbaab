@{
    ViewBag.Title = "View2";
    Layout = "~/Views/Shared/_WallboardLayout.cshtml";
}

@section scripts{
    <script src="~/Scripts/signalR/jquery-3.4.1.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/signalR/jquery.signalR-2.4.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <!--<script src="~/signalr/hubs"></script>-->
    <script type="text/javascript">
        function formatHHMMss(time) {
            var date = new Date(null);
            date.setSeconds(time);
            var result = date.toISOString().substr(11, 8);

            return result;
        }
        //Reference to simpleHub proxy
        var simpleHubProxy;
        var url = "@ViewBag.urlSignalR";       
        //
        var lastPacketTime;
        var currentTime;
        var diffTime;
        //Connect to the SignalR server and get the proxy for simpleHub
        function connect() {
            console.log("conn");

            $.getScript(url + "/hubs", function () {
                $.connection.hub.url = url;

                // Declare a proxy to reference the hub.
                simpleHubProxy = $.connection.simpleHub;

                //Reigster to the "AddMessage" callback method of the hub
                //This method is invoked by the hub
                simpleHubProxy.client.addMessage = function (name, message) {
                    lastPacketTime = Date.now();
                    console.log("lastPacketTime : " + lastPacketTime);
                    //
                    if (name == "adm_runningText") {
                        getRunningText();
                    } else if (name == "adm_video") {
                        getVideo();
                    } else if (name == "adm_imgSlide") {
                        getImageSlide();
                    } else if (name == "adm_imgFoto1") {
                        getImageFoto1();
                    } else if (name == "adm_imgFoto2") {
                        getImageFoto2();
                    }
                    else {
                        var arrData = message.split("\r\n");
                        //console.log(arrData.length);
                        if (arrData.length > 1) {
                            if (arrData[1].substring(0, 5) == ";Agen") {
                                //agentReport(message);
                            } else if (arrData[1].substring(0, 5) == "Split") {
                                //skillReport(message);
                            }
                        }
                    }
                };

                //Connect to hub
                $.connection.hub.start().done(function () {
                    //writeToLog("Connected.");
                    simpleHubProxy.server.setUserName("wb_v2");
                });
            });
        }
        //Disconnect from the server
        function disconnect() {

            if (simpleHubProxy != null) {
                $.connection.hub.stop();
                simpleHubProxy = null;
                //writeToLog("Disconnected.");
                //$.connection.hub.stop().done( function () {
                //    simpleHubProxy = null;
                //    writeToLog("Disconnected.");
                //});
            }
        }
        var i = 0;
        setInterval(function () {
            i = i + 1;
            console.log("i : " + i);
            if (i == 5) {
                console.log("simpleHubProxy : " + simpleHubProxy);
                currentTime = Date.now();
                diffTime = currentTime - lastPacketTime;
                console.log("currTime - lastTime : " + currentTime + "-" + lastPacketTime + "=" + diffTime);
                if (lastPacketTime == undefined) {
                    iCek = iCek + 1;
                }
                if (diffTime > 15000) {
                    iCek = iCek + 1;
                }
                //
                console.log("iCek : " + iCek);
                if (iCek > 25) {
                    connect();
                    iCek = 0;
                }
                //
                if (simpleHubProxy == null) {
                    console.log("simpleHubProxy null");
                    connect();
                }
                i = 0;
            }
        }, 1000);
        function getRunningText() {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("getRunningText", "Admin", "")',
                dataType: 'json',
                async: false,
                success: function (data) {
                    console.log(data.data);
                    $('#txtRunningText').text(data.data);
                },
                error: function (request, status, error) {
                    alert('error on getRunningText : ' + request.responseText);
                }
            });
        }
        function getImageSlide() {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("getImageSlideList", "Admin", "")',
                dataType: 'json',
                async: false,
                success: function (data) {
                    //console.log(data.data[0]);
                    $("#movieSlider").children().remove();
                    var itemImageSlide = '<ol class="carousel-indicators">'
                        + '<li data-target="#carousel-example-generic1" data-slide-to="0" class="active"></li>'
                        + '<li data-target="#carousel-example-generic1" data-slide-to="1"></li>'
                        + '<li data-target="#carousel-example-generic1" data-slide-to="2"></li>'
                        + '</ol>'
                        + '<div class="carousel-inner">'
                        + '<div class="item active">'
                        + '<img src="/UploadedFiles/imageSlide/' + data.data[0].imageSlidePath + '" alt="First slide">'
                        + '<div class="row">'
                        + '<div class="col-md-5 text-right">'
                        + '<h4 class="m-top-lg m-right-md m-bottom-xs text-warning fadeInRightLarge animation-delay4">' + data.data[0].imageSlideNote1 + '</h4>'
                        + '<h3 class="m-top-xs m-right-md text-white fadeInUpLarge animation-delay10">' + data.data[0].imageSlideNote2 + '</h3>'
                        + '</div>'
                        + '</div>'
                        + '</div>'
                        + '<div class="item">'
                        + '<img src="/UploadedFiles/imageSlide/' + data.data[1].imageSlidePath + '" alt="Second slide">'
                        + '<div class="text-center">'
                        + '<h4 class="m-top-lg m-right-md m-bottom-xs text-white fadeInDownLarge animation-delay4">' + data.data[1].imageSlideNote1 + '</h4>'
                        + '<h3 class="m-top-xs m-right-md text-white fadeInLeftLarge animation-delay6">' + data.data[1].imageSlideNote2 + '</h3>'
                        + '</div>'
                        + '</div>'
                        + '<div class="item">'
                        + '<img src="/UploadedFiles/imageSlide/' + data.data[2].imageSlidePath + '" alt="Third slide">'
                        + '<div class="m-top-lg text-center">'
                        + '<h3>'
                        + '<span class="block bounceIn text-white animation-delay4">' + data.data[2].imageSlideNote1 + '</span>'
                        + '<a href="#" class="btn btn-danger m-top-md bounceInDown animation-delay10">' + data.data[2].imageSlideNote2 + '</a>'
                        + '<h3>'
                        + '</div>'
                        + '</div>'
                        + '</div>';

                    //console.log(itemImageSlide);
                    $("#movieSlider").append(itemImageSlide);

                },
                error: function (request, status, error) {
                    alert('error on getImageSlide: ' + request.responseText);
                }
            });
        }
        function getVideo() {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("getVideoList", "Admin", "")',
                dataType: 'json',
                async: false,
                success: function (data) {
                    //console.log(data.data[0]);
                    $(".cVideo").children().remove();
                    var itemVideo = '<div class="col-sm-12 col-xs-6">'
                        + '<div align="center" class="embed-responsive embed-responsive-4by3">'
                        + '<video muted autoplay loop class="embed-responsive-item">'
                        + '<source src="/UploadedFiles/video/' + data.data[0].videoPath + '" type="video/mp4" />'
                        + '</video>'
                        + '</div>'
                        + '</div>'
                        + '<div class="col-sm-12 col-xs-6">'
                        + '<h5 class="featured-name">' + data.data[0].videoTitle +'</h5>'
                        + '<p class="ellipsis">'
                        + data.data[0].videoNote
                        + '</p>'
                        + '</div>';

                    //console.log(itemImageSlide);
                    $(".cVideo").append(itemVideo);

                },
                error: function (request, status, error) {
                    alert('error on getVideo : ' + request.responseText);
                }
            });
        }
        function getImageFoto1() {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("getImageFoto1List", "Admin", "")',
                dataType: 'json',
                async: false,
                success: function (data) {
                    //console.log(data.data);
                    $("#carousel-example-generic-left").children().remove();
                    var itemImageSlide1 = "";
                    itemImageFoto1 = '<ol class="carousel-indicators">'
                    var iSlide11 = 0;
                    for (iSlide11 = 0; iSlide11 < data.data.length; iSlide11++) {
                        var active = iSlide11 == 0 ? "active" : "";
                        itemImageFoto1 += '<li data-target="#carousel-example-generic-left" data-slide-to="' + iSlide11 + '" class="' + active + '"></li>'
                    }
                    itemImageFoto1 += '</ol>'
                    itemImageFoto1 += '<div class="carousel-inner">'
                    var iSlide12 = 0;
                    for (iSlide12 = 0; iSlide12 < data.data.length; iSlide12++) {
                        var active2 = iSlide12 == 0 ? "active" : "";
                        itemImageFoto1 += '<div class="item ' + active2 + '">'
                            + '<div class="row">'
                            + '<div class="col-sm-6">'
                            + '<img src="/UploadedFiles/imageFoto1/' + data.data[iSlide12].imageFoto1Path + '" alt="First slide" class="m-bottom-md" style="height:200px;">'
                            + '</div>'
                            + '<div class="col-sm-6">'
                            + '<strong>' + data.data[iSlide12].imageFoto1Title + '</strong>'
                            + '<p class="m-top-sm">'
                            + data.data[iSlide12].imageFoto1Note
                            + '</p>'
                            + '</div>'
                            + '</div>'
                            + '</div>'
                    }
                    itemImageFoto1 += '</div>';                    
                    
                    //console.log(itemImageFoto1);
                    $("#carousel-example-generic-left").append(itemImageFoto1);

                },
                error: function (request, status, error) {
                    alert('error on getImagefoto1 : ' + request.responseText);
                }
            });
        }
        function getImageFoto2() {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("getImageFoto2List", "Admin", "")',
                dataType: 'json',
                async: false,
                success: function (data) {
                    //console.log(data.data);
                    $("#carousel-example-generic-right").children().remove();
                    var itemImageSlide2 = "";
                    itemImageFoto2 = '<ol class="carousel-indicators">'
                    var iSlide21 = 0;
                    for (iSlide21 = 0; iSlide21 < data.data.length; iSlide21++) {
                        var active = iSlide21 == 0 ? "active" : "";
                        itemImageFoto2 += '<li data-target="#carousel-example-generic-left" data-slide-to="' + iSlide21 + '" class="' + active + '"></li>'
                    }
                    itemImageFoto2 += '</ol>'
                    itemImageFoto2 += '<div class="carousel-inner">'
                    var iSlide22 = 0;
                    for (iSlide22 = 0; iSlide22 < data.data.length; iSlide22++) {
                        var active2 = iSlide22 == 0 ? "active" : "";
                        itemImageFoto2 += '<div class="item ' + active2 + '">'
                            + '<div class="row">'
                            + '<div class="col-sm-6">'
                            + '<img src="/UploadedFiles/imageFoto2/' + data.data[iSlide22].imageFoto2Path + '" alt="First slide" class="m-bottom-md" style="height:200px;">'
                            + '</div>'
                            + '<div class="col-sm-6">'
                            + '<strong>' + data.data[iSlide22].imageFoto2Title + '</strong>'
                            + '<p class="m-top-sm">'
                            + data.data[iSlide22].imageFoto2Note
                            + '</p>'
                            + '</div>'
                            + '</div>'
                            + '</div>'
                    }
                    itemImageFoto2 += '</div>';                    
                    
                    //console.log(itemImageFoto2);
                    $("#carousel-example-generic-right").append(itemImageFoto2);

                },
                error: function (request, status, error) {
                    alert('error on getImageFoto2 : ' + request.responseText);
                }
            });
        }
    </script>
}
<script type="text/javascript">

function dateRealTime() {
const d = new Date();
                    const year = d.getFullYear();
                    let month = d.getMonth() + 1;
                    let date = d.getDate();

if (month < 10) month = '0' + month;
if (date < 10) date = '0' + date;

                    const days = [
                        'Minggu',
                        'Senin',
                        'Selasa',
                        'Rabu',
                        'Kamis',
                        'Juma`at',
                        'Sabtu'
                    ];
                    const dayIndex = d.getDay();
                    const dayName = days[dayIndex];
                    const formatted = dayName + ", " + date + "-" + month + "-" + year;
                    //console.log(formatted);
                    var ret = formatted;

                    return ret;
                }
                //
$(document).ready(function () {
                        //
                        getRunningText();
                    getImageSlide();
                    getVideo();
                    getImageFoto1();
                    getImageFoto2();
                });
</script>
<div class="main-header clearfix">
    <div class="page-title">
        <img src="~/Content/endless/img/logo/logo_png_t.png" style="height:40px; width:150px; margin-left:0px" class="pull-left">
    </div>
    <div class="alert-animated">
        <div class="alert-inner">
            <div class="alert-message">
                <span style="font-size:25px; color:blue; font-weight:bold" id="txtRunningText"></span>
            </div>
        </div>
    </div>
</div>
<div class="padding-md">
    <div class="row">
        <div class="col-sm-3">
            <div class="panel panel-default panel-dark" id="featuredMovie">
                <div class="panel-body">
                    <div class="row cVideo">
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-9">
            <div id="movieSlider" class="carousel slide" data-ride="carousel">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div id="carousel-example-generic-left" class="carousel slide carousel-custom" data-ride="carousel">                        
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div id="carousel-example-generic-right" class="carousel slide carousel-custom" data-ride="carousel">                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


